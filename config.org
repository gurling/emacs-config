#+TITLE:Emily's GNU Emacs Config
#+AUTHOR: Emily
#+DESCRIPTION: Emily's personal Emacs config
#+STARTUP: showeverything
#+OPTIONS: toc:2

My personal Emacs config

* TABLE OF CONTENTS :toc:
- [[#important-programs-to-load-first][Important Programs to load first]]
  - [[#evil-mode][Evil Mode]]
  - [[#general-keybindings][General Keybindings]]
  - [[#vterm-terminal-emulator][Vterm (terminal emulator)]]
- [[#fonts][Fonts]]
- [[#which-key][which-key]]
- [[#gui-tweaks][GUI Tweaks]]
  - [[#disable-menubar-toolbar-scrollbar-and-splash-screen][Disable Menubar, Toolbar, Scrollbar and Splash screen]]
  - [[#display-line-numbers-and-truncated-lines][Display Line Numbers and Truncated Lines]]
  - [[#doom-modeline][Doom Modeline]]
  - [[#beacon-mode][Beacon mode]]
- [[#org-mode][Org Mode]]
  - [[#org-agenda][Org Agenda]]
  - [[#org-capture-templates][Org Capture templates]]
  - [[#table-of-contents][Table Of Contents]]
  - [[#org-bullets][Org Bullets]]
  - [[#disable-electric-indent-mode][Disable Electric Indent mode]]
  - [[#inline-images][Inline Images]]
  - [[#math-settings--org-fragtog-mode][Math Settings + org-fragtog-mode]]
  - [[#google-calendar-org-agenda-integration][Google calendar org-agenda integration]]
- [[#themes][Themes]]
  - [[#catppuccin-theme][Catppuccin theme]]
  - [[#canagawa-theme][Canagawa theme]]
  - [[#timu-spacegrey-theme][timu-spacegrey-theme]]
  - [[#zenburn-theme][Zenburn theme]]
- [[#loading-a-theme][Loading a theme]]
- [[#latex-classes][LaTeX classes]]
  - [[#seminar-work][Seminar Work]]
  - [[#math-notes][Math Notes]]
- [[#custom-functions][Custom functions]]

* Important Programs to load first
** Evil Mode

Install and configure Evil Mode (Vim emulation for Emacs)

#+BEGIN_SRC emacs-lisp
    (use-package evil
    :straight t
    :init
    (setq evil-want-integration t)
    (setq evil-want-keybinding nil)
    (setq evil-vsplit-window-right t)
    (setq evil-split-window-below t)
    (setq evil-undo-system 'undo-redo))

    (use-package evil-collection
      :straight t
      :after evil
      :config
      (setq evil-collection-mode-list '(dashboard dired ibuffer))
      (evil-collection-init))

    (use-package evil-tutor
      :straight t)

    (require 'evil)
    (evil-mode 1)
#+END_SRC

** General Keybindings

#+BEGIN_SRC emacs-lisp
  ;; Free SPC in Evil states where you want it to be a leader
  (with-eval-after-load 'evil
    (define-key evil-emacs-state-map  (kbd "SPC") nil)
    (define-key evil-motion-state-map (kbd "SPC") nil)
    (define-key evil-normal-state-map (kbd "SPC") nil)
    (define-key evil-visual-state-map (kbd "SPC") nil))

    (use-package general
      :straight t
      :config
    (general-evil-setup t)

    ;; st up 'SPC' (Space) as the global leader key
    (general-create-definer emily/leader-keys
    :states '(normal insert visual motion emacs)
    :keymaps 'override
    :prefix "SPC" ;; set leader
    :global-prefix "M-SPC") ;; access leader in insert mode

    (general-create-definer emily/keys
    :states '(normal insert visual emacs)
    :keymaps 'override))

     (emily/leader-keys
     "b" '(:ignore t :wk "buffer")
     "b b" '(switch-to-buffer :wk "Switch buffer")
     "b i" '(ibuffer :wk "Switch buffer")
     "b k" '(kill-current-buffer :wk "Kill this buffer")
     "b n" '(next-buffer :wk "Next buffer")
     "b p" '(previous-buffer :wk "Previous buffer")
     "b r" '(revert-buffer :wk "Reload buffer"))

    (emily/leader-keys
     "f" '(:ignore t :wk "files")
     "f f" '(find-file :wk "find file")
     "f c" '((lambda () (interactive) (find-file "~/.config/emacs/config.org")) :wk "Edit Emacs config"))

    (emily/leader-keys
    "e" '(:ignore t :wk "eval")
    "e r" '(eval-region :wk "Evaluate Region")
    "e b" '(eval-buffer :wk "Evaluate Buffer"))

    (emily/leader-keys
     "h" '(:ignore t :wk "help")
     "h v" '(describe-variable :wk "describe variable")
     "h f" '(describe-function :wk "describe function")
     "h r r" '((lambda () (interactive) (load-file "~/.config/emacs/init.el")) :wk "Reload Emacs config"))

    (emily/leader-keys
    "w" '(:ignore t :wk "window")
    "w h" '(evil-window-left :wk "focus left")
    "w j" '(evil-window-down :wk "focus down")
    "w k" '(evil-window-up :wk "focus up")
    "w l" '(evil-window-right :wk "focus right")
    "w S-h" '(evil-window-move-far-left :wk "move left")
    "w S-j" '(evil-window-move-very-bottom :wk "move down")
    "w S-k" '(evil-window-move-very-top :wk "move up")
    "w S-l" '(evil-window-move-far-right :wk "move right")
    "w c" '(evil-quit :wk "close window")
    "w s" '(evil-window-split :wk "horizontal split")
    "w v" '(evil-window-vsplit :wk "vertical split"))

   (emily/leader-keys ;; misc
    "g c" '(comment-set-column :wk "comment line"))
   
   (emily/keys ;; zooming
    "C-+" '(text-scale-increase :wk "Zoom +")
    "C-=" '(text-scale-increase :wk "Zoom +")
    "C--" '(text-scale-decrease :wk "Zoom -")
    "C-_" '(text-scale-decrease :wk "Zoom -"))

  (emily/leader-keys ;; Org
   "o" '(:ignore t :wk "Org")
   "o a" '(org-agenda :wk "Org Agenda")
   ;; "o a" '((lambda () (interactive) (evil-window-split) (org-agenda)) :wk "Org Agenda")
   "o t" '(org-table-create :wk "Org Table"))
  
  (emily/leader-keys ;; Terminal
   "t" '(:ignore t :wk "Terminal")
   "t o" '(vterm-toggle :wk "Toggle VTerm"))

#+END_SRC

** Vterm (terminal emulator)

#+BEGIN_SRC emacs-lisp
(use-package vterm
    :ensure t
    :straight t)

(use-package vterm-toggle
    :ensure t
    :straight t)

#+END_SRC

* Fonts

#+begin_src emacs-lisp
(defvar fixed-pitch-font "BlexMono Nerd Font-16"
  "Monospace font")

(defvar variable-pitch-font "IBM Plex Sans"
  "Proportional font")

    (set-face-attribute 'default nil
      :font fixed-pitch-font
      :height 150
      :weight 'medium)
    (set-face-attribute 'variable-pitch nil
      :font variable-pitch-font
      :height 150
      :weight 'medium)
    (set-face-attribute 'fixed-pitch nil
      :font fixed-pitch-font
      :height 150
      :weight 'medium)
    (set-face-attribute 'default nil
    :font fixed-pitch-font
    :height 150
    :weight 'medium)
  (set-face-attribute 'variable-pitch nil
    :font variable-pitch-font
    :height 160
    :weight 'medium)
  (set-face-attribute 'fixed-pitch nil
    :font fixed-pitch-font
    :height 150
    :weight 'medium)
  ;; Makes commented text and keywords italics.
  ;; This is working in emacsclient but not emacs.
  ;; Your font must have an italic face available.
  (set-face-attribute 'font-lock-comment-face nil
    :slant 'italic)
  (set-face-attribute 'font-lock-keyword-face nil
    :slant 'italic)

  ;; This sets the default font on all graphical frames created after restarting Emacs.
  ;; Does the same thing as 'set-face-attribute default' above, but emacsclient fonts
  ;; are not right unless I also add this method of setting the default font.
  (add-to-list 'default-frame-alist `(font . ,fixed-pitch-font))

  ;; Uncomment the following line if line spacing needs adjusting.
  ;; (setq-default line-spacing 0.12)
  
#+end_src


* which-key

#+BEGIN_SRC emacs-lisp
  (use-package which-key
    :straight t
    :init
      (which-key-mode 1)
    :config
    (setq which-key-side-window-location 'bottom
  	  which-key-sort-order #'which-key-key-order-alpha
  	  which-key-sort-uppercase-first nil
  	  which-key-add-column-padding 1
  	  which-key-max-display-columns nil
  	  which-key-min-display-lines 6
  	  which-key-side-window-slot -10
  	  which-key-side-window-max-height 0.25
  	  which-key-idle-delay 0.8
  	  which-key-max-description-length 25
  	  which-key-allow-imprecise-window-fit t
  	  which-key-separator " → " ))
#+END_SRC

* GUI Tweaks

** Disable Menubar, Toolbar, Scrollbar and Splash screen

#+BEGIN_SRC emacs-lisp
  (menu-bar-mode -1)
  (tool-bar-mode -1)
  (scroll-bar-mode -1)
  (setq inhibit-startup-screen t)

#+END_SRC

** Display Line Numbers and Truncated Lines

#+BEGIN_SRC emacs-lisp
  (global-display-line-numbers-mode 1)
  (global-visual-line-mode t)

#+END_SRC

** Doom Modeline

#+BEGIN_SRC emacs-lisp
(use-package nerd-icons
  :straight t
  :custom
  ;; The Nerd Font you want to use in GUI
  ;; "Symbols Nerd Font Mono" is the default and is recommended
  ;; but you can use any other Nerd Font if you want
  (nerd-icons-font-family "BlexMono Nerd Font"))
  (use-package doom-modeline
    :straight t
    :ensure t
    :init (doom-modeline-mode 1))
#+END_SRC

** Beacon mode

#+BEGIN_SRC emacs-lisp
(use-package beacon
 :straight t)

(beacon-mode 1)

#+END_SRC

* Org Mode
** Org Agenda

#+BEGIN_SRC emacs-lisp
  (setq org-agenda-files
        '(
          ;;"~/org/routine.org"
          "~/org" ;; Local org-agenda files
          ;; "~/Nextcloud/org" ;; Remote org-agenda files
          "~/Nextcloud/org-gcal/schedule.org"    ;; My main Google Calendar file
          "~/Nextcloud/org-gcal/school.org"   ;; My school class calendar (whole class)
          ;;"~/Nextcloud/org-gcal/school-group.org"   ;; My school class calendar (my group)
         ))

#+END_SRC

** Org Capture templates

#+BEGIN_SRC emacs-lisp
  ;;  (require 'org-capture)

  ;; (defvar ma-notes-dir (expand-file-name "~/Nextcloud/SPSSOL/2025-2026/MA/"))

  ;; (defun ma--capture-file ()
  ;;   (make-directory ma-notes-dir t)
  ;;   (expand-file-name (format-time-string "%d-%m-%Y.org") ma-notes-dir))

  ;; (add-to-list 'org-capture-templates
  ;;              '("m" "math note (today)" plain
  ;;                (file ma--capture-file)
  ;;                "#+TITLE: MA %<%d-%m-%Y>\n
  ;;                 #+DATE: %<%d-%m-%Y>\n
  ;;                 #+AUTHOR: AverageArchLinuxUser\n
  ;;                 #+LANGUAGE: cs\n
  ;;                 #+LATEX_CLASS: mathnotes\n
  ;;                 #+OPTIONS: toc:t num:t\n%?"
  ;;                :empty-lines 1))
   
#+END_SRC

** Table Of Contents

#+BEGIN_SRC emacs-lisp
(setq org-return-follows-link t)
  (use-package toc-org
    :straight t
    :commands toc-org-enable
    :init (add-hook 'org-mode-hook 'toc-org-enable))
  (setq org-export-exclude-tags '("noexport")) ;; Don't export headings with ":noexport:" tag, useful for TODO 

#+END_SRC

** Org Bullets

#+BEGIN_SRC emacs-lisp
  (add-hook 'org-mode-hook 'org-indent-mode)
  (use-package org-bullets
    :straight t)
  (add-hook 'org-mode-hook (lambda () (org-bullets-mode 1)))

#+END_SRC
** Disable Electric Indent mode

#+BEGIN_SRC emacs-lisp
(electric-indent-mode -1)
#+END_SRC

** Inline Images

#+BEGIN_SRC emacs-lisp
    (setq org-image-actual-width 300)
    ;;(add-hook 'org-mode-hook (lambda () (org-toggle-inline-images 1)))
#+END_SRC

** Math Settings + org-fragtog-mode

#+BEGIN_SRC emacs-lisp
;; ---------- Org: math previews ----------
(setq org-highlight-latex-and-related '(latex script entities))

;; Crisp previews (vector). Works great on HiDPI.
(setq org-preview-latex-default-process 'dvisvgm)

;; Bigger previews (adjust to taste)
(setq org-format-latex-options
      (plist-put org-format-latex-options :scale 2))

;; ---------- Org -> PDF (latexmk) ----------
(setq org-latex-compiler "pdflatex")

(use-package org-fragtog
 :straight t)

(add-hook 'org-mode-hook 'org-fragtog-mode)


#+END_SRC 

** Google calendar org-agenda integration

#+BEGIN_SRC emacs-lisp
;; 1. Setup Auth-Source-Pass
(require 'auth-source-pass)
(auth-source-pass-enable)

;; 2. Define the helper function
(defun my/get-org-gcal-creds ()
  (let ((entry (auth-source-pass-parse-entry "org-gcal")))
    (if entry
        (list :client-id (alist-get "client-id" entry nil nil #'equal) ;; <--- The Fix: Use 'equal to match strings
              :client-secret (alist-get 'secret entry))
      nil)))

;; 3. PRE-SET the variables.
(let ((creds (my/get-org-gcal-creds)))
  (if creds
      (progn
        (setq org-gcal-client-id (plist-get creds :client-id))
        (setq org-gcal-client-secret (plist-get creds :client-secret))
        (message "Org-Gcal: Credentials successfully loaded from pass."))
    (message "Org-Gcal: Credentials NOT found.")))

;; 4. Load org-gcal
(use-package org-gcal
  :ensure t
  :commands (org-gcal-fetch)
  :config
  (setq org-gcal-token-file "~/.config/emacs/.org-gcal-token")
  ;; Replace with your specific calendar details
(setq org-gcal-fetch-file-alist
      '(
        ;; 1. Your primary calendar (Keep this)
        ("owpender@gmail.com" . "~/Nextcloud/org-gcal/schedule.org")

        ;; 2. The Shared/Other Calendar (Add this)
        ;; Format: ("CALENDAR_ID" . "PATH_TO_TARGET_FILE")
        ("690a21d405ccefdb3dc688d3044bb18f5bdb22c1f3ad318122e1cc70cbf911c5@group.calendar.google.com" . "~/Nextcloud/org-gcal/school.org")
        ("ef5ed25db98651afff1a11cfa33fc669358f1dbdfafaedc6232e87b9ce50826e@group.calendar.google.com" . "~/Nextcloud/org-gcal/school-group.org" )
       )))
#+END_SRC
* Themes
** Catppuccin theme

Install and configure the Catppuccin Emacs theme.

#+BEGIN_SRC emacs-lisp
      (use-package catppuccin-theme 
        :straight t)
      (setq catppuccin-flavor 'frappe) ;; or 'latte, 'macchiato, or 'mocha
      (catppuccin-reload)

  (setq org-src-fontify-natively t)
  (add-to-list 'org-src-block-faces (list "" (list :foreground (catppuccin-get-color 'green))))

  (defun ctp/text-org-blocks ()
    (face-remap-add-relative 'org-block (list :foreground (catppuccin-get-color 'text))))
  (add-hook 'org-mode-hook 'ctp/text-org-blocks)

#+END_SRC

** Canagawa theme

#+BEGIN_SRC emacs-lisp
(use-package kanagawa-themes
  :straight t
  :ensure t)
#+END_SRC
** timu-spacegrey-theme

#+BEGIN_SRC emacs-lisp
(use-package timu-spacegrey-theme
  :straight t
  :ensure t
  :config)
#+END_SRC

** Zenburn theme

#+BEGIN_SRC emacs-lisp
(use-package zenburn-theme
  :straight t)

#+END_SRC

* Loading a theme

#+BEGIN_SRC emacs-lisp
;;(load-theme 'catppuccin t)
(load-theme 'kanagawa-wave t)
;;(load-theme 'timu-spacegrey t)
;;(load-theme 'zenburn t)
#+END_SRC

* LaTeX classes
** Seminar Work
#+BEGIN_SRC emacs-lisp
(with-eval-after-load 'ox-latex
  (setq org-latex-pdf-process
        '("pdflatex -interaction=nonstopmode -output-directory %o %f"
          "bibtex %b"
          "pdflatex -interaction=nonstopmode -output-directory %o %f"
          "pdflatex -interaction=nonstopmode -output-directory %o %f")))
(setq org-latex-tables-booktabs t)
(require 'ox-latex)

(add-to-list 'org-latex-classes
             '("spssol-seminarka"
               "\\documentclass[12pt,a4paper]{article}
\\usepackage[a4paper,left=35mm,right=20mm,top=30mm,bottom=30mm]{geometry}
\\usepackage[czech]{babel}
\\usepackage[utf8]{inputenc}
\\usepackage[T1]{fontenc}
\\usepackage{times}           % podobné Times New Roman
\\usepackage{setspace}
\\onehalfspacing              % řádkování 1,5
\\pagestyle{plain}"           
               ("\\section{%s}" . "\\section*{%s}")
               ("\\subsection{%s}" . "\\subsection*{%s}")
               ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
               ("\\paragraph{%s}" . "\\paragraph*{%s}")
               ("\\subparagraph{%s}" . "\\subparagraph*{%s}")))
#+END_SRC

** Math Notes

#+BEGIN_SRC emacs-lisp
;; Ensure the directory exists before tangling
(make-directory (expand-file-name "~/texmf/tex/latex/mathnotes/") t)
#+END_SRC

#+BEGIN_SRC latex :tangle ~/texmf/tex/latex/mathnotes/mathnotes.cls
%% mathnotes.cls -- clean pdflatex class for math notes
\NeedsTeXFormat{LaTeX2e}
\ProvidesClass{mathnotes}[Math Notes]

% Base class
\LoadClassWithOptions{article}

% --------------------
% Encoding + fonts (pdflatex)
% --------------------
\RequirePackage[T1]{fontenc}
\RequirePackage[utf8]{inputenc}
\RequirePackage{lmodern}
\RequirePackage{microtype}

% --------------------
% Page layout
% --------------------
\RequirePackage{geometry}
\geometry{margin=25mm}

\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\raggedbottom

% --------------------
% Math
% --------------------
\RequirePackage{mathtools} % loads amsmath
\RequirePackage{amssymb}
\RequirePackage{amsthm}
\RequirePackage{bm}
\RequirePackage{cancel}

\allowdisplaybreaks[2]
\mathtoolsset{showonlyrefs} % eq numbers only if referenced via \ref

% Slightly tighter displayed-math spacing (nice for algebra steps)
\AtBeginDocument{%
  \setlength{\abovedisplayskip}{8pt plus 2pt minus 2pt}%
  \setlength{\belowdisplayskip}{8pt plus 2pt minus 2pt}%
  \setlength{\abovedisplayshortskip}{6pt plus 2pt minus 2pt}%
  \setlength{\belowdisplayshortskip}{6pt plus 2pt minus 2pt}%
}

% Handy paired delimiters (use \abs{x} or \abs*{x} for auto sizing)
\DeclarePairedDelimiter{\abs}{\lvert}{\rvert}
\DeclarePairedDelimiter{\norm}{\lVert}{\rVert}

% Boxed final answer macro
\newcommand{\final}[1]{\boxed{\displaystyle #1}}

% Optional common sets (comment out if you don’t want them)
\newcommand{\NN}{\mathbb{N}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\QQ}{\mathbb{Q}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\CC}{\mathbb{C}}

% --------------------
% Units / numbers
% --------------------
\RequirePackage{siunitx}
\sisetup{detect-all, per-mode=symbol}

% --------------------
% Lists / tables / figures
% --------------------
\RequirePackage{enumitem}
\setlist{nosep}
\setlist[enumerate]{label=\textbf{\arabic*.}, leftmargin=*}

\RequirePackage{booktabs}
\RequirePackage{longtable}
\RequirePackage{graphicx}

% --------------------
% Links (Org-safe)
% --------------------
\RequirePackage{xcolor}

\makeatletter
% Avoid "Option clash" if hyperref is already loaded (e.g., by Org export)
\@ifpackageloaded{hyperref}{}{%
  \RequirePackage[hidelinks]{hyperref}%
}
\makeatother

% --------------------
% Headings + header/footer
% --------------------
\RequirePackage{titlesec}
\titleformat{\section}{\large\bfseries}{\thesection}{0.6em}{}
\titleformat{\subsection}{\normalsize\bfseries}{\thesubsection}{0.6em}{}
\titleformat{\subsubsection}{\normalsize\bfseries}{\thesubsubsection}{0.6em}{}

\RequirePackage{fancyhdr}

\makeatletter
% Ensure \leftmark updates nicely in article
\renewcommand{\sectionmark}[1]{\markboth{\thesection\ #1}{}}

\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}

\AtBeginDocument{%
  \fancyhf{}%
  \lhead{\small\nouppercase{\@title}}%
  \rhead{\small\nouppercase{\leftmark}}%
  \cfoot{\thepage}%
}
\makeatother

% --------------------
% Theorem environments
% --------------------
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{corollary}[theorem]{Corollary}

\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}

\theoremstyle{remark}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{note}[theorem]{Note}

% --------------------
% Title
% --------------------
\makeatletter
\renewcommand{\maketitle}{%
  \thispagestyle{empty}%
  \begin{center}
    {\LARGE\bfseries \@title \par}
    \vspace{0.6em}
  \end{center}
  \vspace{0.3em}
  \hrule
  \vspace{1.0em}
}
\makeatother

% End
\endinput

#+END_SRC

#+BEGIN_SRC emacs-lisp
(with-eval-after-load 'ox-latex
  (add-to-list 'org-latex-classes
               '("mathnotes"
                 "\\documentclass{mathnotes}"
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")
                 ("\\subsubsection{%s}" . "\\subsubsection*{%s}")
                 ("\\paragraph{%s}" . "\\paragraph*{%s}")
                 ("\\subparagraph{%s}" . "\\subparagraph*{%s}"))))

#+END_SRC
* Custom functions

#+BEGIN_SRC emacs-lisp
;;; --- math notes: create daily file with template ---

(defvar ma-notes-dir (expand-file-name "~/Nextcloud/SPSSOL/2025-2026/MA/")
  "Directory for math notes.")

(defun ma--today-stamp ()
  "Return date as DD-MM-YYYY."
  (format-time-string "%d-%m-%Y"))

(defun ma--note-path (&optional date-stamp)
  "Return full path for DATE-STAMP (DD-MM-YYYY). Defaults to today."
  (let ((ds (or date-stamp (ma--today-stamp))))
    (expand-file-name (concat ds ".org") ma-notes-dir)))

(defun ma--insert-template (date-stamp)
  "Insert the standard MA org header."
  (insert
   (format "#+TITLE: MA %s\n" date-stamp)
   (format "#+DATE: %s\n" date-stamp)
   ;;(format "#+AUTHOR: %s\n" (or user-full-name ""))
  )
   "#+LANGUAGE: cs\n"
   "#+LATEX_CLASS: mathnotes\n"
   "#+OPTIONS: toc:nil num:nil\n\n"))

(defun ma-new-note (&optional date-stamp)
  "Create/open an MA note for DATE-STAMP (DD-MM-YYYY). With prefix arg, prompt."
  (interactive
   (list (when current-prefix-arg
           (read-string "Date (DD-MM-YYYY): " (ma--today-stamp)))))
  (let* ((ds (or date-stamp (ma--today-stamp)))
         (path (ma--note-path ds)))
    (make-directory ma-notes-dir t)
    (find-file path)
    (when (= (buffer-size) 0)
      (org-mode)
      (ma--insert-template ds))))

;; keybind
(global-set-key (kbd "C-c m n") #'ma-new-note)


#+END_SRC
